
# Cillium results

These are the results of the latest cillium run for Cilium version: 1.9.5


```
Version: 0.4.0
Git SHA: 9374a1a7511cfd4e1f1955bbcb46f247b91b0fe2
Build time: 2021-03-27T11:07:15Z
time="2021-03-27T15:17:55Z" level=info msg="log level set to 'info'"
time="2021-03-27T15:18:02Z" level=info msg="waiting for 9 pods to be running and have IP addresses; currently 0 are ready"
resources:
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| NAMESPACE | NS LABELS | POD | POD LABELS |          IPS           |        CONTAINERS/PORTS        |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| x         | ns: x     | a   | pod: a     | pod: 10.244.4.131      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.36.202  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.244.2.233      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.200.177 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.244.1.18       | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.235.190 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
time="2021-03-27T15:18:08Z" level=info msg="test #1 to run: set namespace to x"
time="2021-03-27T15:18:08Z" level=info msg="test #2 to run: set namespace to y"
time="2021-03-27T15:18:08Z" level=info msg="test #3 to run: set namespace to z"
time="2021-03-27T15:18:08Z" level=info msg="test #4 to run: set pod selector to [\"MatchLabels\",null,\"MatchExpression\",null]"
time="2021-03-27T15:18:08Z" level=info msg="test #5 to run: set pod selector to [\"MatchLabels\",[\"pod: a\"],\"MatchExpression\",null]"
time="2021-03-27T15:18:08Z" level=info msg="test #6 to run: set pod selector to [\"MatchLabels\",null,\"MatchExpression\",[{\"key\":\"pod\",\"operator\":\"In\",\"values\":[\"a\",\"b\"]}]]"
time="2021-03-27T15:18:08Z" level=info msg="test #7 to run: egress: deny all"
time="2021-03-27T15:18:08Z" level=info msg="test #8 to run: egress: allow all"
time="2021-03-27T15:18:08Z" level=info msg="test #9 to run: ingress: deny all"
time="2021-03-27T15:18:08Z" level=info msg="test #10 to run: ingress: allow all"
time="2021-03-27T15:18:08Z" level=info msg="test #11 to run: ingress: empty peers"
time="2021-03-27T15:18:08Z" level=info msg="test #12 to run: egress: empty peers"
time="2021-03-27T15:18:08Z" level=info msg="test #13 to run: empty pods + nil ns"
time="2021-03-27T15:18:08Z" level=info msg="test #14 to run: pods by label + nil ns"
time="2021-03-27T15:18:08Z" level=info msg="test #15 to run: nil pods + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #16 to run: empty pods + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #17 to run: pods by label + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #18 to run: nil pods + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #19 to run: empty pods + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #20 to run: pods by label + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #21 to run: simple ipblock"
time="2021-03-27T15:18:08Z" level=info msg="test #22 to run: ipblock with except"
time="2021-03-27T15:18:08Z" level=info msg="test #23 to run: empty pods + nil ns"
time="2021-03-27T15:18:08Z" level=info msg="test #24 to run: pods by label + nil ns"
time="2021-03-27T15:18:08Z" level=info msg="test #25 to run: nil pods + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #26 to run: empty pods + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #27 to run: pods by label + empty ns"
time="2021-03-27T15:18:08Z" level=info msg="test #28 to run: nil pods + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #29 to run: empty pods + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #30 to run: pods by label + ns by label"
time="2021-03-27T15:18:08Z" level=info msg="test #31 to run: simple ipblock"
time="2021-03-27T15:18:08Z" level=info msg="test #32 to run: ipblock with except"
time="2021-03-27T15:18:08Z" level=info msg="test #33 to run: egress: empty port/protocol"
time="2021-03-27T15:18:08Z" level=info msg="test #34 to run: ingress: empty port/protocol"
time="2021-03-27T15:18:08Z" level=info msg="test #35 to run: any-port,direction,egress,port"
time="2021-03-27T15:18:08Z" level=info msg="test #36 to run: direction,egress,numbered-port,port"
time="2021-03-27T15:18:08Z" level=info msg="test #37 to run: direction,egress,numbered-port,port"
time="2021-03-27T15:18:08Z" level=info msg="test #38 to run: any-port,direction,egress,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #39 to run: direction,egress,numbered-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #40 to run: direction,egress,numbered-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #41 to run: any-port,direction,egress,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #42 to run: direction,egress,numbered-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #43 to run: direction,egress,numbered-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #44 to run: any-port,direction,egress,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #45 to run: direction,egress,numbered-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #46 to run: direction,egress,numbered-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #47 to run: direction,egress,named-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #48 to run: direction,egress,named-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #49 to run: direction,egress,named-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #50 to run: direction,egress,named-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #51 to run: direction,egress,named-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #52 to run: direction,egress,named-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #53 to run: open a named port that doesn't match its protocol"
time="2021-03-27T15:18:08Z" level=info msg="test #54 to run: open a named port that isn't served"
time="2021-03-27T15:18:08Z" level=info msg="test #55 to run: open a numbered port that isn't served"
time="2021-03-27T15:18:08Z" level=info msg="test #56 to run: any-port,direction,ingress,port"
time="2021-03-27T15:18:08Z" level=info msg="test #57 to run: direction,ingress,numbered-port,port"
time="2021-03-27T15:18:08Z" level=info msg="test #58 to run: direction,ingress,numbered-port,port"
time="2021-03-27T15:18:08Z" level=info msg="test #59 to run: any-port,direction,ingress,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #60 to run: direction,ingress,numbered-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #61 to run: direction,ingress,numbered-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #62 to run: any-port,direction,ingress,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #63 to run: direction,ingress,numbered-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #64 to run: direction,ingress,numbered-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #65 to run: any-port,direction,ingress,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #66 to run: direction,ingress,numbered-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #67 to run: direction,ingress,numbered-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #68 to run: direction,ingress,named-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #69 to run: direction,ingress,named-port,port,protocol,tcp"
time="2021-03-27T15:18:08Z" level=info msg="test #70 to run: direction,ingress,named-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #71 to run: direction,ingress,named-port,port,protocol,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #72 to run: direction,ingress,named-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #73 to run: direction,ingress,named-port,port,protocol,sctp"
time="2021-03-27T15:18:08Z" level=info msg="test #74 to run: open a named port that doesn't match its protocol"
time="2021-03-27T15:18:08Z" level=info msg="test #75 to run: open a named port that isn't served"
time="2021-03-27T15:18:08Z" level=info msg="test #76 to run: open a numbered port that isn't served"
time="2021-03-27T15:18:08Z" level=info msg="test #77 to run: any-port,direction,egress,multi-port/protocol,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #78 to run: any-port,direction,egress,multi-port/protocol,named-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #79 to run: any-port,direction,egress,multi-port/protocol,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #80 to run: direction,egress,multi-port/protocol,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #81 to run: direction,egress,multi-port/protocol,named-port,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #82 to run: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #83 to run: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #84 to run: any-port,direction,ingress,multi-port/protocol,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #85 to run: any-port,direction,ingress,multi-port/protocol,named-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #86 to run: any-port,direction,ingress,multi-port/protocol,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #87 to run: direction,ingress,multi-port/protocol,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #88 to run: direction,ingress,multi-port/protocol,named-port,numbered-port,port,rule"
time="2021-03-27T15:18:08Z" level=info msg="test #89 to run: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #90 to run: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp"
time="2021-03-27T15:18:08Z" level=info msg="test #91 to run: Create/delete policy"
time="2021-03-27T15:18:08Z" level=info msg="test #92 to run: Create/update policy"
time="2021-03-27T15:18:08Z" level=info msg="test #93 to run: Create/delete namespace"
time="2021-03-27T15:18:08Z" level=info msg="test #94 to run: Update namespace so that policy applies, then again so it no longer applies"
time="2021-03-27T15:18:08Z" level=info msg="test #95 to run: Create/delete pod"
time="2021-03-27T15:18:08Z" level=info msg="test #96 to run: Update pod so that policy applies, then again so it no longer applies"
time="2021-03-27T15:18:08Z" level=info msg="test #97 to run: deny all from source, allow all to dest"
time="2021-03-27T15:18:08Z" level=info msg="test #98 to run: allow all from source, deny all to dest"
time="2021-03-27T15:18:08Z" level=info msg="test #99 to run: deny all + allow all from same source"
time="2021-03-27T15:18:08Z" level=info msg="test #100 to run: deny all + allow all to same dest"
time="2021-03-27T15:18:08Z" level=info msg="test #101 to run: deny all + allow all by pod from same source"
time="2021-03-27T15:18:08Z" level=info msg="test #102 to run: deny all + allow all by IP from same source"
time="2021-03-27T15:18:08Z" level=info msg="test #103 to run: deny all by IP + allow all by pod from same source"
time="2021-03-27T15:18:08Z" level=info msg="test #104 to run: deny all by pod + allow all by IP from same source"
time="2021-03-27T15:18:08Z" level=info msg="test #105 to run: deny all + allow all by pod to same source"
time="2021-03-27T15:18:08Z" level=info msg="test #106 to run: deny all + allow all by IP to same source"
time="2021-03-27T15:18:08Z" level=info msg="test #107 to run: deny all by IP + allow all by pod to same source"
time="2021-03-27T15:18:08Z" level=info msg="test #108 to run: deny all by pod + allow all by IP to same source"
time="2021-03-27T15:18:08Z" level=info msg="test #109 to run: egress: deny all by IP"
time="2021-03-27T15:18:08Z" level=info msg="test #110 to run: egress: deny all by pod"
time="2021-03-27T15:18:08Z" level=info msg="test #111 to run: ingress: deny all by IP"
time="2021-03-27T15:18:08Z" level=info msg="test #112 to run: ingress: deny all by pod"
time="2021-03-27T15:18:08Z" level=info msg="starting test case #1"
| y         | ns: y     | a   | pod: a     | pod: 10.244.4.109      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.49.160  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.244.2.1        | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.255.68  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.244.1.34       | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.186.49  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| z         | ns: z     | a   | pod: a     | pod: 10.244.4.236      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.226.213 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.244.2.126      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.212.15  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.244.1.168      | cont-80-tcp, port              |
|           |           |     |            | service: 10.96.51.56   | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+-----------+-----------+-----+------------+------------------------+--------------------------------+

test cases to run by tag:
- namespaces-by-label: 6
- policy-namespace: 4
- update-policy: 1
- rule: 30
- multi-port/protocol: 14
- target-namespace: 3
- action: 6
- peer-pods: 20
- example: 0
- delete-pod: 1
- direction: 100
- udp: 16
- upstream-e2e: 0
- policy-stack: 0
- named-port: 24
- peer-ipblock: 4
- all-namespaces: 10
- pathological: 6
- sctp: 10
- deny-all: 10
- set-namespace-labels: 1
- target-pod-selector: 3
- create-namespace: 1
- protocol: 42
- set-pod-labels: 1
- pods-by-label: 6
- tcp: 16
- port: 56
- delete-namespace: 1
- create-pod: 1
- conflict: 16
- miscellaneous: 22
- numbered-port: 28
- allow-all: 6
- multi-peer: 0
- all-pods: 14
- ingress: 51
- egress: 51
- ip-block-with-except: 2
- any-port: 14
- create-policy: 2
- delete-policy: 1
- target: 6
- any-peer: 2
- ip-block-no-except: 2
- any-port-protocol: 2
testing 112 cases

time="2021-03-27T15:18:13Z" level=info msg="cluster state reset"
time="2021-03-27T15:18:16Z" level=info msg="cluster state verified"
time="2021-03-27T15:18:16Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:18:21Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:18:21Z" level=info msg="running kube probe on try 1"
evaluating test case: set namespace to x
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:18:41Z" level=info msg="finished policy #1"
time="2021-03-27T15:18:41Z" level=info msg="starting test case #2"
time="2021-03-27T15:18:44Z" level=info msg="cluster state reset"
time="2021-03-27T15:18:47Z" level=info msg="cluster state verified"
time="2021-03-27T15:18:47Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:18:52Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:18:52Z" level=info msg="running kube probe on try 1"
evaluating test case: set namespace to y
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: y  | y/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: y  | y/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: "y"
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | X   | X   | X   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:19:10Z" level=info msg="finished policy #2"
time="2021-03-27T15:19:10Z" level=info msg="starting test case #3"
time="2021-03-27T15:19:13Z" level=info msg="cluster state reset"
time="2021-03-27T15:19:16Z" level=info msg="cluster state verified"
time="2021-03-27T15:19:16Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:19:21Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:19:21Z" level=info msg="running kube probe on try 1"
evaluating test case: set namespace to z
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: z  | z/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: z  | z/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: z
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
time="2021-03-27T15:19:40Z" level=info msg="finished policy #3"
time="2021-03-27T15:19:40Z" level=info msg="starting test case #4"
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | X   | X   | .   | .   | X   | X   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:19:43Z" level=info msg="cluster state reset"
time="2021-03-27T15:19:46Z" level=info msg="cluster state verified"
time="2021-03-27T15:19:46Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:19:51Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:19:51Z" level=info msg="running kube probe on try 1"
evaluating test case: set pod selector to ["MatchLabels",null,"MatchExpression",null]
step 1 on all available ports/protocols:
Policy explanation:
+---------+--------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET    | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+--------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x | x/base       | no ips                        | no ports, no protocols  |
|         | all pods     |              |                               |                         |
+         +              +              +-------------------------------+-------------------------+
|         |              |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |              |              |   ns In [x y]                 |                         |
|         |              |              | pods: Match expressions:      |                         |
|         |              |              |   pod In [b c]                |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+
|         |              |              |                               |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | all pods     |              |                               |                         |
+         +              +              +-------------------------------+-------------------------+
|         |              |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |              |              |   ns In [y z]                 |                         |
|         |              |              | pods: Match expressions:      |                         |
|         |              |              |   pod In [a b]                |                         |
+         +              +              +-------------------------------+-------------------------+
|         |              |              | namespace: all                | port 53 on protocol UDP |
|         |              |              | pods: all                     |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:20:12Z" level=info msg="finished policy #4"
time="2021-03-27T15:20:12Z" level=info msg="starting test case #5"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:20:15Z" level=info msg="cluster state reset"
time="2021-03-27T15:20:18Z" level=info msg="cluster state verified"
time="2021-03-27T15:20:18Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:20:23Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:20:23Z" level=info msg="running kube probe on try 1"
evaluating test case: set pod selector to ["MatchLabels",["pod: a"],"MatchExpression",null]
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:20:41Z" level=info msg="finished policy #5"
time="2021-03-27T15:20:41Z" level=info msg="starting test case #6"
time="2021-03-27T15:20:44Z" level=info msg="cluster state reset"
time="2021-03-27T15:20:47Z" level=info msg="cluster state verified"
time="2021-03-27T15:20:47Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:20:52Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:20:52Z" level=info msg="running kube probe on try 1"
evaluating test case: set pod selector to ["MatchLabels",null,"MatchExpression",[{"key":"pod","operator":"In","values":["a","b"]}]]
step 1 on all available ports/protocols:
Policy explanation:
+---------+--------------------+--------------+-------------------------------+-------------------------+
|  TYPE   |       TARGET       | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+--------------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x       | x/base       | no ips                        | no ports, no protocols  |
|         | Match expressions: |              |                               |                         |
|         |   pod In [a b]     |              |                               |                         |
+         +                    +              +-------------------------------+-------------------------+
|         |                    |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |                    |              |   ns In [x y]                 |                         |
|         |                    |              | pods: Match expressions:      |                         |
|         |                    |              |   pod In [b c]                |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+
|         |                    |              |                               |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x       | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match expressions: |              |                               |                         |
|         |   pod In [a b]     |              |                               |                         |
+         +                    +              +-------------------------------+-------------------------+
|         |                    |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |                    |              |   ns In [y z]                 |                         |
|         |                    |              | pods: Match expressions:      |                         |
|         |                    |              |   pod In [a b]                |                         |
+         +                    +              +-------------------------------+-------------------------+
|         |                    |              | namespace: all                | port 53 on protocol UDP |
|         |                    |              | pods: all                     |                         |
|         |                    |              |                               |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchExpressions:
    - key: pod
      operator: In
      values:
      - a
      - b
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:21:12Z" level=info msg="finished policy #6"
time="2021-03-27T15:21:12Z" level=info msg="starting test case #7"
time="2021-03-27T15:21:14Z" level=info msg="cluster state reset"
time="2021-03-27T15:21:17Z" level=info msg="cluster state verified"
time="2021-03-27T15:21:17Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:21:22Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:21:22Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: deny all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | no pods, no ips               | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:23:53Z" level=info msg="finished policy #7"
time="2021-03-27T15:23:53Z" level=info msg="starting test case #8"
time="2021-03-27T15:23:56Z" level=info msg="cluster state reset"
time="2021-03-27T15:23:59Z" level=info msg="cluster state verified"
time="2021-03-27T15:23:59Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:24:04Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:24:04Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: allow all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | all ports, all protocols |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
time="2021-03-27T15:24:22Z" level=info msg="finished policy #8"
time="2021-03-27T15:24:22Z" level=info msg="starting test case #9"
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:24:25Z" level=info msg="cluster state reset"
time="2021-03-27T15:24:28Z" level=info msg="cluster state verified"
time="2021-03-27T15:24:28Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:24:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:24:33Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: deny all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no pods, no ips               | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:24:52Z" level=info msg="finished policy #9"
time="2021-03-27T15:24:52Z" level=info msg="starting test case #10"
time="2021-03-27T15:24:55Z" level=info msg="cluster state reset"
time="2021-03-27T15:24:58Z" level=info msg="cluster state verified"
time="2021-03-27T15:24:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:25:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:25:03Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: allow all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | all pods, all ips             | all ports, all protocols |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - {}
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:25:22Z" level=info msg="finished policy #10"
time="2021-03-27T15:25:22Z" level=info msg="starting test case #11"
time="2021-03-27T15:25:25Z" level=info msg="cluster state reset"
time="2021-03-27T15:25:28Z" level=info msg="cluster state verified"
time="2021-03-27T15:25:28Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:25:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:25:33Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: empty peers
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | ports for all IPs             | port 80 on protocol TCP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:25:51Z" level=info msg="finished policy #11"
time="2021-03-27T15:25:51Z" level=info msg="starting test case #12"
time="2021-03-27T15:25:54Z" level=info msg="cluster state reset"
time="2021-03-27T15:25:57Z" level=info msg="cluster state verified"
time="2021-03-27T15:25:57Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:26:02Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:26:02Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: empty peers
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 80 on protocol TCP |
|         | Match labels: |              |                               | port 53 on protocol UDP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:26:20Z" level=info msg="finished policy #12"
time="2021-03-27T15:26:20Z" level=info msg="starting test case #13"
time="2021-03-27T15:26:23Z" level=info msg="cluster state reset"
time="2021-03-27T15:26:26Z" level=info msg="cluster state verified"
time="2021-03-27T15:26:26Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:26:31Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:26:31Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: x                  | port 80 on protocol TCP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
time="2021-03-27T15:26:50Z" level=info msg="finished policy #13"
time="2021-03-27T15:26:50Z" level=info msg="starting test case #14"
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:26:53Z" level=info msg="cluster state reset"
time="2021-03-27T15:26:56Z" level=info msg="cluster state verified"
time="2021-03-27T15:26:56Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:27:01Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:27:01Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: x                  | port 80 on protocol TCP |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:27:19Z" level=info msg="finished policy #14"
time="2021-03-27T15:27:19Z" level=info msg="starting test case #15"
time="2021-03-27T15:27:22Z" level=info msg="cluster state reset"
time="2021-03-27T15:27:25Z" level=info msg="cluster state verified"
time="2021-03-27T15:27:25Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:27:30Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:27:30Z" level=info msg="running kube probe on try 1"
evaluating test case: nil pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:27:49Z" level=info msg="finished policy #15"
time="2021-03-27T15:27:49Z" level=info msg="starting test case #16"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:27:52Z" level=info msg="cluster state reset"
time="2021-03-27T15:27:55Z" level=info msg="cluster state verified"
time="2021-03-27T15:27:55Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:28:00Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:28:00Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector: {}
      podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:28:18Z" level=info msg="finished policy #16"
time="2021-03-27T15:28:18Z" level=info msg="starting test case #17"
time="2021-03-27T15:28:21Z" level=info msg="cluster state reset"
time="2021-03-27T15:28:24Z" level=info msg="cluster state verified"
time="2021-03-27T15:28:24Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:28:29Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:28:29Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:28:48Z" level=info msg="finished policy #17"
time="2021-03-27T15:28:48Z" level=info msg="starting test case #18"
time="2021-03-27T15:28:51Z" level=info msg="cluster state reset"
time="2021-03-27T15:28:54Z" level=info msg="cluster state verified"
time="2021-03-27T15:28:54Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:28:59Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:28:59Z" level=info msg="running kube probe on try 1"
evaluating test case: nil pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:29:18Z" level=info msg="finished policy #18"
time="2021-03-27T15:29:18Z" level=info msg="starting test case #19"
time="2021-03-27T15:29:20Z" level=info msg="cluster state reset"
time="2021-03-27T15:29:23Z" level=info msg="cluster state verified"
time="2021-03-27T15:29:23Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:29:28Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:29:28Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:29:47Z" level=info msg="finished policy #19"
time="2021-03-27T15:29:47Z" level=info msg="starting test case #20"
time="2021-03-27T15:29:50Z" level=info msg="cluster state reset"
time="2021-03-27T15:29:53Z" level=info msg="cluster state verified"
time="2021-03-27T15:29:53Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:29:58Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:29:58Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:30:17Z" level=info msg="finished policy #20"
time="2021-03-27T15:30:17Z" level=info msg="starting test case #21"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:30:20Z" level=info msg="cluster state reset"
time="2021-03-27T15:30:23Z" level=info msg="cluster state verified"
time="2021-03-27T15:30:23Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:30:28Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:30:28Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:30:47Z" level=info msg="running kube probe on try 2"
evaluating test case: simple ipblock
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | ports for all IPs             | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | 10.244.1.168/24               | port 80 on protocol TCP |
|         |               |              | except []                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | no pods                       | no ports, no protocols  |
|         |               |              |                               |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - ipBlock:
        cidr: 10.244.1.168/24
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:3 wrong, 9 ignored, 69 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:31:06Z" level=info msg="finished policy #21"
time="2021-03-27T15:31:06Z" level=info msg="starting test case #22"
time="2021-03-27T15:31:08Z" level=info msg="cluster state reset"
time="2021-03-27T15:31:11Z" level=info msg="cluster state verified"
time="2021-03-27T15:31:11Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:31:16Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:31:16Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:31:35Z" level=info msg="running kube probe on try 2"
evaluating test case: ipblock with except
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | ports for all IPs             | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | 10.244.1.168/24               | port 80 on protocol TCP |
|         |               |              | except [10.244.1.168/28]      |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | no pods                       | no ports, no protocols  |
|         |               |              |                               |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - ipBlock:
        cidr: 10.244.1.168/24
        except:
        - 10.244.1.168/28
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:2 wrong, 9 ignored, 70 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:31:54Z" level=info msg="finished policy #22"
time="2021-03-27T15:31:54Z" level=info msg="starting test case #23"
time="2021-03-27T15:31:57Z" level=info msg="cluster state reset"
time="2021-03-27T15:32:00Z" level=info msg="cluster state verified"
time="2021-03-27T15:32:00Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:32:05Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:32:05Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: x                  | port 80 on protocol TCP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - podSelector: {}
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:32:24Z" level=info msg="finished policy #23"
time="2021-03-27T15:32:24Z" level=info msg="starting test case #24"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:32:27Z" level=info msg="cluster state reset"
time="2021-03-27T15:32:30Z" level=info msg="cluster state verified"
time="2021-03-27T15:32:30Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:32:35Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:32:35Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: x                  | port 80 on protocol TCP |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - podSelector:
        matchLabels:
          pod: c
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:32:53Z" level=info msg="finished policy #24"
time="2021-03-27T15:32:53Z" level=info msg="starting test case #25"
time="2021-03-27T15:32:56Z" level=info msg="cluster state reset"
time="2021-03-27T15:32:59Z" level=info msg="cluster state verified"
time="2021-03-27T15:32:59Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:33:04Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:33:04Z" level=info msg="running kube probe on try 1"
evaluating test case: nil pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: all                     | port 53 on protocol UDP |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector: {}
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:33:23Z" level=info msg="finished policy #25"
time="2021-03-27T15:33:23Z" level=info msg="starting test case #26"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:33:26Z" level=info msg="cluster state reset"
time="2021-03-27T15:33:29Z" level=info msg="cluster state verified"
time="2021-03-27T15:33:29Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:33:34Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:33:34Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: all                     | port 53 on protocol UDP |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector: {}
      podSelector: {}
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:33:52Z" level=info msg="finished policy #26"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
time="2021-03-27T15:33:52Z" level=info msg="starting test case #27"
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:33:55Z" level=info msg="cluster state reset"
time="2021-03-27T15:33:58Z" level=info msg="cluster state verified"
time="2021-03-27T15:33:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:34:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:34:03Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 80 on protocol TCP |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          pod: c
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | .   | X   | X   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:34:22Z" level=info msg="finished policy #27"
time="2021-03-27T15:34:22Z" level=info msg="starting test case #28"
time="2021-03-27T15:34:25Z" level=info msg="cluster state reset"
time="2021-03-27T15:34:28Z" level=info msg="cluster state verified"
time="2021-03-27T15:34:28Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:34:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:34:33Z" level=info msg="running kube probe on try 1"
evaluating test case: nil pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: all                     |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          ns: x
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:34:52Z" level=info msg="finished policy #28"
time="2021-03-27T15:34:52Z" level=info msg="starting test case #29"
time="2021-03-27T15:34:54Z" level=info msg="cluster state reset"
time="2021-03-27T15:34:57Z" level=info msg="cluster state verified"
time="2021-03-27T15:34:57Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:35:02Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:35:02Z" level=info msg="running kube probe on try 1"
evaluating test case: empty pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector: {}
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:35:21Z" level=info msg="finished policy #29"
time="2021-03-27T15:35:21Z" level=info msg="starting test case #30"
time="2021-03-27T15:35:24Z" level=info msg="cluster state reset"
time="2021-03-27T15:35:27Z" level=info msg="cluster state verified"
time="2021-03-27T15:35:27Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:35:32Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:35:32Z" level=info msg="running kube probe on try 1"
evaluating test case: pods by label + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   ns: x                       |                         |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector:
        matchLabels:
          pod: c
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:35:51Z" level=info msg="finished policy #30"
time="2021-03-27T15:35:51Z" level=info msg="starting test case #31"
time="2021-03-27T15:35:54Z" level=info msg="cluster state reset"
time="2021-03-27T15:35:57Z" level=info msg="cluster state verified"
time="2021-03-27T15:35:57Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:36:02Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:36:02Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:36:21Z" level=info msg="running kube probe on try 2"
evaluating test case: simple ipblock
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | 10.244.1.168/24               | port 80 on protocol TCP |
|         |               |              | except []                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - ipBlock:
        cidr: 10.244.1.168/24
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:3 wrong, 9 ignored, 69 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | .   | X   | X   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | .   | X   | X   | .   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | X   | .   | .   | X   | .   | .   | X   |
| x/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:36:41Z" level=info msg="finished policy #31"
time="2021-03-27T15:36:41Z" level=info msg="starting test case #32"
time="2021-03-27T15:36:44Z" level=info msg="cluster state reset"
time="2021-03-27T15:36:47Z" level=info msg="cluster state verified"
time="2021-03-27T15:36:47Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:36:52Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:36:52Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:37:11Z" level=info msg="running kube probe on try 2"
evaluating test case: ipblock with except
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | 10.244.1.168/24               | port 80 on protocol TCP |
|         |               |              | except [10.244.1.168/28]      |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - ipBlock:
        cidr: 10.244.1.168/24
        except:
        - 10.244.1.168/28
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:2 wrong, 9 ignored, 70 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | .   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | .   | X   | X   | .   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | X   | .   | .   | X   | .   | .   | .   |
| x/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:37:30Z" level=info msg="finished policy #32"
time="2021-03-27T15:37:30Z" level=info msg="starting test case #33"
time="2021-03-27T15:37:33Z" level=info msg="cluster state reset"
time="2021-03-27T15:37:36Z" level=info msg="cluster state verified"
time="2021-03-27T15:37:36Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:37:41Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:37:41Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: empty port/protocol
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | all ports, all protocols |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:37:59Z" level=info msg="finished policy #33"
time="2021-03-27T15:37:59Z" level=info msg="starting test case #34"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:38:02Z" level=info msg="cluster state reset"
time="2021-03-27T15:38:05Z" level=info msg="cluster state verified"
time="2021-03-27T15:38:05Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:38:10Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:38:10Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: empty port/protocol
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | all ports, all protocols |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
time="2021-03-27T15:38:29Z" level=info msg="finished policy #34"
time="2021-03-27T15:38:29Z" level=info msg="starting test case #35"
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:38:32Z" level=info msg="cluster state reset"
time="2021-03-27T15:38:35Z" level=info msg="cluster state verified"
time="2021-03-27T15:38:35Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:38:40Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:38:40Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:38:58Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - {}
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T15:39:16Z" level=info msg="finished policy #35"
time="2021-03-27T15:39:16Z" level=info msg="starting test case #36"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:39:19Z" level=info msg="cluster state reset"
time="2021-03-27T15:39:22Z" level=info msg="cluster state verified"
time="2021-03-27T15:39:22Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:39:27Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:39:27Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:39:46Z" level=info msg="finished policy #36"
time="2021-03-27T15:39:46Z" level=info msg="starting test case #37"
time="2021-03-27T15:39:49Z" level=info msg="cluster state reset"
time="2021-03-27T15:39:52Z" level=info msg="cluster state verified"
time="2021-03-27T15:39:52Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:39:57Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:39:57Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 81
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:40:15Z" level=info msg="finished policy #37"
time="2021-03-27T15:40:15Z" level=info msg="starting test case #38"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:40:18Z" level=info msg="cluster state reset"
time="2021-03-27T15:40:21Z" level=info msg="cluster state verified"
time="2021-03-27T15:40:21Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:40:26Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:40:26Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:40:44Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+                           +
|         |               |              | namespace: all                |                           |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:41:02Z" level=info msg="finished policy #38"
time="2021-03-27T15:41:02Z" level=info msg="starting test case #39"
time="2021-03-27T15:41:04Z" level=info msg="cluster state reset"
time="2021-03-27T15:41:07Z" level=info msg="cluster state verified"
time="2021-03-27T15:41:07Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:41:12Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:41:12Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:41:31Z" level=info msg="finished policy #39"
time="2021-03-27T15:41:31Z" level=info msg="starting test case #40"
time="2021-03-27T15:41:34Z" level=info msg="cluster state reset"
time="2021-03-27T15:41:37Z" level=info msg="cluster state verified"
time="2021-03-27T15:41:37Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:41:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:41:42Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 81
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:42:01Z" level=info msg="finished policy #40"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:42:01Z" level=info msg="starting test case #41"
time="2021-03-27T15:42:04Z" level=info msg="cluster state reset"
time="2021-03-27T15:42:07Z" level=info msg="cluster state verified"
time="2021-03-27T15:42:07Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:42:12Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:42:12Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:42:30Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol UDP |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


time="2021-03-27T15:42:48Z" level=info msg="finished policy #41"
time="2021-03-27T15:42:48Z" level=info msg="starting test case #42"
Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:42:51Z" level=info msg="cluster state reset"
time="2021-03-27T15:42:54Z" level=info msg="cluster state verified"
time="2021-03-27T15:42:54Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:42:59Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:42:59Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol UDP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:43:17Z" level=info msg="finished policy #42"
time="2021-03-27T15:43:17Z" level=info msg="starting test case #43"
time="2021-03-27T15:43:20Z" level=info msg="cluster state reset"
time="2021-03-27T15:43:23Z" level=info msg="cluster state verified"
time="2021-03-27T15:43:23Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:43:28Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:43:28Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,numbered-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol UDP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 81
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:43:47Z" level=info msg="finished policy #43"
time="2021-03-27T15:43:47Z" level=info msg="starting test case #44"
time="2021-03-27T15:43:50Z" level=info msg="cluster state reset"
time="2021-03-27T15:43:53Z" level=info msg="cluster state verified"
time="2021-03-27T15:43:53Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:43:58Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:43:58Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:44:16Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+----------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL        |
+---------+---------------+--------------+-------------------------------+----------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols     |
|         | Match labels: |              |                               |                            |
|         |   pod: a      |              |                               |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP    |
|         |               |              |   ns In [x y]                 |                            |
|         |               |              | pods: Match expressions:      |                            |
|         |               |              |   pod In [b c]                |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+
|         |               |              |                               |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP    |
|         | Match labels: |              |                               |                            |
|         |   pod: a      |              |                               |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol SCTP |
|         |               |              |   ns In [y z]                 |                            |
|         |               |              | pods: Match expressions:      |                            |
|         |               |              |   pod In [a b]                |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP    |
|         |               |              | pods: all                     |                            |
|         |               |              |                               |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - protocol: SCTP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:44:34Z" level=info msg="finished policy #44"
time="2021-03-27T15:44:34Z" level=info msg="starting test case #45"
time="2021-03-27T15:44:37Z" level=info msg="cluster state reset"
time="2021-03-27T15:44:40Z" level=info msg="cluster state verified"
time="2021-03-27T15:44:40Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:44:45Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:44:45Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:45:03Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,egress,numbered-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol SCTP |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: SCTP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T15:45:20Z" level=info msg="finished policy #45"
time="2021-03-27T15:45:20Z" level=info msg="starting test case #46"
kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:45:23Z" level=info msg="cluster state reset"
time="2021-03-27T15:45:26Z" level=info msg="cluster state verified"
time="2021-03-27T15:45:26Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:45:31Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:45:31Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:45:49Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,egress,numbered-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol SCTP |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 81
      protocol: SCTP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T15:46:07Z" level=info msg="finished policy #46"
time="2021-03-27T15:46:07Z" level=info msg="starting test case #47"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:46:10Z" level=info msg="cluster state reset"
time="2021-03-27T15:46:13Z" level=info msg="cluster state verified"
time="2021-03-27T15:46:13Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:46:18Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:46:18Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,named-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-tcp on protocol TCP |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-80-tcp
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:46:37Z" level=info msg="finished policy #47"
time="2021-03-27T15:46:37Z" level=info msg="starting test case #48"
time="2021-03-27T15:46:40Z" level=info msg="cluster state reset"
time="2021-03-27T15:46:43Z" level=info msg="cluster state verified"
time="2021-03-27T15:46:43Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:46:48Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:46:48Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,named-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-tcp on protocol TCP |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-81-tcp
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:47:07Z" level=info msg="finished policy #48"
time="2021-03-27T15:47:07Z" level=info msg="starting test case #49"
time="2021-03-27T15:47:09Z" level=info msg="cluster state reset"
time="2021-03-27T15:47:12Z" level=info msg="cluster state verified"
time="2021-03-27T15:47:12Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:47:17Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:47:17Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,named-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-udp on protocol UDP |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-80-udp
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:47:36Z" level=info msg="finished policy #49"
time="2021-03-27T15:47:36Z" level=info msg="starting test case #50"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:47:39Z" level=info msg="cluster state reset"
time="2021-03-27T15:47:42Z" level=info msg="cluster state verified"
time="2021-03-27T15:47:42Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:47:47Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:47:47Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,named-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-udp on protocol UDP |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-81-udp
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
time="2021-03-27T15:48:06Z" level=info msg="finished policy #50"
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:48:06Z" level=info msg="starting test case #51"
time="2021-03-27T15:48:09Z" level=info msg="cluster state reset"
time="2021-03-27T15:48:12Z" level=info msg="cluster state verified"
time="2021-03-27T15:48:12Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:48:17Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:48:17Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:48:35Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,egress,named-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-sctp on protocol SCTP |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP             |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-80-sctp
      protocol: SCTP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:48:52Z" level=info msg="finished policy #51"
time="2021-03-27T15:48:52Z" level=info msg="starting test case #52"
time="2021-03-27T15:48:55Z" level=info msg="cluster state reset"
time="2021-03-27T15:48:58Z" level=info msg="cluster state verified"
time="2021-03-27T15:48:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:49:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:49:03Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:49:21Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,egress,named-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-sctp on protocol SCTP |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP             |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-81-sctp
      protocol: SCTP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:49:39Z" level=info msg="finished policy #52"
time="2021-03-27T15:49:39Z" level=info msg="starting test case #53"
time="2021-03-27T15:49:42Z" level=info msg="cluster state reset"
time="2021-03-27T15:49:45Z" level=info msg="cluster state verified"
time="2021-03-27T15:49:45Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:49:50Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:49:50Z" level=info msg="running kube probe on try 1"
evaluating test case: open a named port that doesn't match its protocol
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-udp on protocol TCP |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-81-udp
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:50:08Z" level=info msg="finished policy #53"
time="2021-03-27T15:50:08Z" level=info msg="starting test case #54"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:50:11Z" level=info msg="cluster state reset"
time="2021-03-27T15:50:14Z" level=info msg="cluster state verified"
time="2021-03-27T15:50:14Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:50:19Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:50:19Z" level=info msg="running kube probe on try 1"
evaluating test case: open a named port that isn't served
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-7981-udp on protocol TCP |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP             |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: serve-7981-udp
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
time="2021-03-27T15:50:39Z" level=info msg="finished policy #54"
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:50:39Z" level=info msg="starting test case #55"
time="2021-03-27T15:50:41Z" level=info msg="cluster state reset"
time="2021-03-27T15:50:44Z" level=info msg="cluster state verified"
time="2021-03-27T15:50:44Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:50:49Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:50:49Z" level=info msg="running kube probe on try 1"
evaluating test case: open a numbered port that isn't served
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 7981 on protocol TCP |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 7981
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:51:08Z" level=info msg="finished policy #55"
time="2021-03-27T15:51:08Z" level=info msg="starting test case #56"
time="2021-03-27T15:51:11Z" level=info msg="cluster state reset"
time="2021-03-27T15:51:14Z" level=info msg="cluster state verified"
time="2021-03-27T15:51:14Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:51:19Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:51:19Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:51:38Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - {}
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T15:51:57Z" level=info msg="finished policy #56"
time="2021-03-27T15:51:57Z" level=info msg="starting test case #57"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:52:00Z" level=info msg="cluster state reset"
time="2021-03-27T15:52:03Z" level=info msg="cluster state verified"
time="2021-03-27T15:52:03Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:52:08Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:52:08Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:52:28Z" level=info msg="finished policy #57"
time="2021-03-27T15:52:28Z" level=info msg="starting test case #58"
time="2021-03-27T15:52:30Z" level=info msg="cluster state reset"
time="2021-03-27T15:52:33Z" level=info msg="cluster state verified"
time="2021-03-27T15:52:33Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:52:38Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:52:38Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 81
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:52:58Z" level=info msg="finished policy #58"
time="2021-03-27T15:52:58Z" level=info msg="starting test case #59"
time="2021-03-27T15:53:01Z" level=info msg="cluster state reset"
time="2021-03-27T15:53:04Z" level=info msg="cluster state verified"
time="2021-03-27T15:53:04Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:53:09Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:53:09Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:53:27Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:53:46Z" level=info msg="finished policy #59"
time="2021-03-27T15:53:46Z" level=info msg="starting test case #60"
time="2021-03-27T15:53:49Z" level=info msg="cluster state reset"
time="2021-03-27T15:53:52Z" level=info msg="cluster state verified"
time="2021-03-27T15:53:52Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:53:57Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:53:57Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:54:15Z" level=info msg="finished policy #60"
time="2021-03-27T15:54:15Z" level=info msg="starting test case #61"
time="2021-03-27T15:54:18Z" level=info msg="cluster state reset"
time="2021-03-27T15:54:21Z" level=info msg="cluster state verified"
time="2021-03-27T15:54:21Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:54:26Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:54:26Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 81
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T15:54:45Z" level=info msg="finished policy #61"
time="2021-03-27T15:54:45Z" level=info msg="starting test case #62"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:54:48Z" level=info msg="cluster state reset"
time="2021-03-27T15:54:51Z" level=info msg="cluster state verified"
time="2021-03-27T15:54:51Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:54:56Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:54:56Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:55:14Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol UDP |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:55:32Z" level=info msg="finished policy #62"
time="2021-03-27T15:55:32Z" level=info msg="starting test case #63"
time="2021-03-27T15:55:35Z" level=info msg="cluster state reset"
time="2021-03-27T15:55:38Z" level=info msg="cluster state verified"
time="2021-03-27T15:55:38Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:55:43Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:55:43Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol UDP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:56:02Z" level=info msg="finished policy #63"
time="2021-03-27T15:56:02Z" level=info msg="starting test case #64"
time="2021-03-27T15:56:04Z" level=info msg="cluster state reset"
time="2021-03-27T15:56:07Z" level=info msg="cluster state verified"
time="2021-03-27T15:56:07Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:56:12Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:56:12Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,numbered-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol UDP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 81
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:56:32Z" level=info msg="finished policy #64"
time="2021-03-27T15:56:32Z" level=info msg="starting test case #65"
time="2021-03-27T15:56:34Z" level=info msg="cluster state reset"
time="2021-03-27T15:56:37Z" level=info msg="cluster state verified"
time="2021-03-27T15:56:37Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:56:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:56:42Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:57:00Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+----------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL        |
+---------+---------------+--------------+-------------------------------+----------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols     |
|         | Match labels: |              |                               |                            |
|         |   pod: a      |              |                               |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol SCTP |
|         |               |              |   ns In [x y]                 |                            |
|         |               |              | pods: Match expressions:      |                            |
|         |               |              |   pod In [b c]                |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+
|         |               |              |                               |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP    |
|         | Match labels: |              |                               |                            |
|         |   pod: a      |              |                               |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP    |
|         |               |              |   ns In [y z]                 |                            |
|         |               |              | pods: Match expressions:      |                            |
|         |               |              |   pod In [a b]                |                            |
+         +               +              +-------------------------------+----------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP    |
|         |               |              | pods: all                     |                            |
|         |               |              |                               |                            |
+---------+---------------+--------------+-------------------------------+----------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - protocol: SCTP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:57:18Z" level=info msg="finished policy #65"
time="2021-03-27T15:57:18Z" level=info msg="starting test case #66"
time="2021-03-27T15:57:20Z" level=info msg="cluster state reset"
time="2021-03-27T15:57:23Z" level=info msg="cluster state verified"
time="2021-03-27T15:57:23Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:57:28Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:57:29Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:57:47Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,ingress,numbered-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol SCTP |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: SCTP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:58:05Z" level=info msg="finished policy #66"
time="2021-03-27T15:58:05Z" level=info msg="starting test case #67"
time="2021-03-27T15:58:07Z" level=info msg="cluster state reset"
time="2021-03-27T15:58:10Z" level=info msg="cluster state verified"
time="2021-03-27T15:58:10Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:58:15Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:58:15Z" level=info msg="running kube probe on try 1"
time="2021-03-27T15:58:34Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,ingress,numbered-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols   |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 81 on protocol SCTP |
|         |               |              |   ns In [x y]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP  |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP  |
|         |               |              | pods: all                     |                          |
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 81
      protocol: SCTP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:58:53Z" level=info msg="finished policy #67"
time="2021-03-27T15:58:53Z" level=info msg="starting test case #68"
time="2021-03-27T15:58:55Z" level=info msg="cluster state reset"
time="2021-03-27T15:58:58Z" level=info msg="cluster state verified"
time="2021-03-27T15:58:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:59:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:59:03Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,named-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-tcp on protocol TCP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-80-tcp
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:59:23Z" level=info msg="finished policy #68"
time="2021-03-27T15:59:23Z" level=info msg="starting test case #69"
time="2021-03-27T15:59:26Z" level=info msg="cluster state reset"
time="2021-03-27T15:59:29Z" level=info msg="cluster state verified"
time="2021-03-27T15:59:29Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T15:59:34Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T15:59:34Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,named-port,port,protocol,tcp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-tcp on protocol TCP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-81-tcp
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T15:59:53Z" level=info msg="finished policy #69"
time="2021-03-27T15:59:53Z" level=info msg="starting test case #70"
time="2021-03-27T15:59:56Z" level=info msg="cluster state reset"
time="2021-03-27T15:59:59Z" level=info msg="cluster state verified"
time="2021-03-27T15:59:59Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:00:04Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:00:04Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,named-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-udp on protocol UDP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-80-udp
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:00:24Z" level=info msg="finished policy #70"
time="2021-03-27T16:00:24Z" level=info msg="starting test case #71"
time="2021-03-27T16:00:26Z" level=info msg="cluster state reset"
time="2021-03-27T16:00:29Z" level=info msg="cluster state verified"
time="2021-03-27T16:00:29Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:00:34Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:00:34Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,named-port,port,protocol,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-udp on protocol UDP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-81-udp
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:00:53Z" level=info msg="finished policy #71"
time="2021-03-27T16:00:53Z" level=info msg="starting test case #72"
time="2021-03-27T16:00:56Z" level=info msg="cluster state reset"
time="2021-03-27T16:00:59Z" level=info msg="cluster state verified"
time="2021-03-27T16:00:59Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:01:04Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:01:04Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:01:23Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,ingress,named-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-80-sctp on protocol SCTP |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP             |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-80-sctp
      protocol: SCTP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:01:41Z" level=info msg="finished policy #72"
time="2021-03-27T16:01:41Z" level=info msg="starting test case #73"
time="2021-03-27T16:01:44Z" level=info msg="cluster state reset"
time="2021-03-27T16:01:47Z" level=info msg="cluster state verified"
time="2021-03-27T16:01:47Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:01:52Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:01:52Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:02:11Z" level=info msg="running kube probe on try 2"
evaluating test case: direction,ingress,named-port,port,protocol,sctp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-sctp on protocol SCTP |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+                                     +
|         |               |              | namespace: all                |                                     |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-81-sctp
      protocol: SCTP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:02:31Z" level=info msg="finished policy #73"
time="2021-03-27T16:02:31Z" level=info msg="starting test case #74"
time="2021-03-27T16:02:34Z" level=info msg="cluster state reset"
time="2021-03-27T16:02:37Z" level=info msg="cluster state verified"
time="2021-03-27T16:02:37Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:02:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:02:42Z" level=info msg="running kube probe on try 1"
evaluating test case: open a named port that doesn't match its protocol
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-udp on protocol TCP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+                                   +
|         |               |              | namespace: all                |                                   |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-81-udp
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:03:01Z" level=info msg="finished policy #74"
time="2021-03-27T16:03:01Z" level=info msg="starting test case #75"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:03:04Z" level=info msg="cluster state reset"
time="2021-03-27T16:03:07Z" level=info msg="cluster state verified"
time="2021-03-27T16:03:07Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:03:12Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:03:12Z" level=info msg="running kube probe on try 1"
evaluating test case: open a named port that isn't served
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |            PORT/PROTOCOL            |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols              |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port serve-7981-udp on protocol TCP |
|         |               |              |   ns In [x y]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [b c]                |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP             |
|         | Match labels: |              |                               |                                     |
|         |   pod: a      |              |                               |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP             |
|         |               |              |   ns In [y z]                 |                                     |
|         |               |              | pods: Match expressions:      |                                     |
|         |               |              |   pod In [a b]                |                                     |
+         +               +              +-------------------------------+-------------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP             |
|         |               |              | pods: all                     |                                     |
|         |               |              |                               |                                     |
+---------+---------------+--------------+-------------------------------+-------------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-7981-udp
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:03:32Z" level=info msg="finished policy #75"
time="2021-03-27T16:03:32Z" level=info msg="starting test case #76"
time="2021-03-27T16:03:35Z" level=info msg="cluster state reset"
time="2021-03-27T16:03:38Z" level=info msg="cluster state verified"
time="2021-03-27T16:03:38Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:03:43Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:03:43Z" level=info msg="running kube probe on try 1"
evaluating test case: open a numbered port that isn't served
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 7981 on protocol TCP |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 7981
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:04:03Z" level=info msg="finished policy #76"
time="2021-03-27T16:04:03Z" level=info msg="starting test case #77"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:04:06Z" level=info msg="cluster state reset"
time="2021-03-27T16:04:09Z" level=info msg="cluster state verified"
time="2021-03-27T16:04:09Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:04:14Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:04:14Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:04:33Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,multi-port/protocol,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [y z]                 | port 80 on protocol TCP   |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - {}
    - port: 80
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T16:04:52Z" level=info msg="finished policy #77"
time="2021-03-27T16:04:52Z" level=info msg="starting test case #78"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:04:55Z" level=info msg="cluster state reset"
time="2021-03-27T16:04:58Z" level=info msg="cluster state verified"
time="2021-03-27T16:04:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:05:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:05:03Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:05:21Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,multi-port/protocol,named-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP         |
|         |               |              |   ns In [y z]                 | port serve-80-tcp on protocol TCP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - {}
    - port: serve-80-tcp
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T16:05:39Z" level=info msg="finished policy #78"
time="2021-03-27T16:05:39Z" level=info msg="starting test case #79"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:05:42Z" level=info msg="cluster state reset"
time="2021-03-27T16:05:45Z" level=info msg="cluster state verified"
time="2021-03-27T16:05:45Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:05:50Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:05:50Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:06:09Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,egress,multi-port/protocol,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [x y]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [y z]                 | all ports on protocol UDP |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - {}
    - protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:12 wrong, 9 ignored, 60 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | .   | .   | X   | .   | .   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:06:28Z" level=info msg="finished policy #79"
time="2021-03-27T16:06:28Z" level=info msg="starting test case #80"
time="2021-03-27T16:06:31Z" level=info msg="cluster state reset"
time="2021-03-27T16:06:34Z" level=info msg="cluster state verified"
time="2021-03-27T16:06:34Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:06:39Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:06:39Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,multi-port/protocol,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 | port 81 on protocol TCP |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
    - port: 81
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:06:59Z" level=info msg="finished policy #80"
time="2021-03-27T16:06:59Z" level=info msg="starting test case #81"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:07:02Z" level=info msg="cluster state reset"
time="2021-03-27T16:07:05Z" level=info msg="cluster state verified"
time="2021-03-27T16:07:05Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:07:10Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:07:10Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,multi-port/protocol,named-port,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 | port serve-81-tcp on protocol TCP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
time="2021-03-27T16:07:30Z" level=info msg="finished policy #81"
time="2021-03-27T16:07:30Z" level=info msg="starting test case #82"
    - port: serve-81-tcp
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:07:32Z" level=info msg="cluster state reset"
time="2021-03-27T16:07:35Z" level=info msg="cluster state verified"
time="2021-03-27T16:07:35Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:07:40Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:07:40Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+                                   +
|         |               |              | namespace: all                |                                   |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 | port serve-81-udp on protocol UDP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
    - port: serve-81-udp
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:08:00Z" level=info msg="finished policy #82"
time="2021-03-27T16:08:00Z" level=info msg="starting test case #83"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:08:03Z" level=info msg="cluster state reset"
time="2021-03-27T16:08:06Z" level=info msg="cluster state verified"
time="2021-03-27T16:08:06Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:08:11Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:08:11Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol UDP           |
|         |               |              |   ns In [y z]                 | port serve-81-udp on protocol UDP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: UDP
    - port: serve-81-udp
      protocol: UDP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | .   | .   | X   | .   | .   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:08:30Z" level=info msg="finished policy #83"
time="2021-03-27T16:08:30Z" level=info msg="starting test case #84"
time="2021-03-27T16:08:33Z" level=info msg="cluster state reset"
time="2021-03-27T16:08:36Z" level=info msg="cluster state verified"
time="2021-03-27T16:08:36Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:08:41Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:08:41Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:09:00Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,multi-port/protocol,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [x y]                 | port 80 on protocol TCP   |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - {}
    - port: 80
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T16:09:19Z" level=info msg="finished policy #84"
time="2021-03-27T16:09:19Z" level=info msg="starting test case #85"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:09:22Z" level=info msg="cluster state reset"
time="2021-03-27T16:09:25Z" level=info msg="cluster state verified"
time="2021-03-27T16:09:25Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:09:30Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:09:30Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:09:48Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,multi-port/protocol,named-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP         |
|         |               |              |   ns In [x y]                 | port serve-80-tcp on protocol TCP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - {}
    - port: serve-80-tcp
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:16 wrong, 9 ignored, 56 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
time="2021-03-27T16:10:07Z" level=info msg="finished policy #85"
| x/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:10:07Z" level=info msg="starting test case #86"
time="2021-03-27T16:10:10Z" level=info msg="cluster state reset"
time="2021-03-27T16:10:13Z" level=info msg="cluster state verified"
time="2021-03-27T16:10:13Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:10:18Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:10:18Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:10:36Z" level=info msg="running kube probe on try 2"
evaluating test case: any-port,direction,ingress,multi-port/protocol,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+---------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |       PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols    |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | all ports on protocol TCP |
|         |               |              |   ns In [x y]                 | all ports on protocol UDP |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [b c]                |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP   |
|         | Match labels: |              |                               |                           |
|         |   pod: a      |              |                               |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP   |
|         |               |              |   ns In [y z]                 |                           |
|         |               |              | pods: Match expressions:      |                           |
|         |               |              |   pod In [a b]                |                           |
+         +               +              +-------------------------------+---------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP   |
|         |               |              | pods: all                     |                           |
|         |               |              |                               |                           |
+---------+---------------+--------------+-------------------------------+---------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - {}
    - protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:12 wrong, 9 ignored, 60 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T16:10:55Z" level=info msg="finished policy #86"
time="2021-03-27T16:10:55Z" level=info msg="starting test case #87"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | X   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:10:58Z" level=info msg="cluster state reset"
time="2021-03-27T16:11:01Z" level=info msg="cluster state verified"
time="2021-03-27T16:11:01Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:11:06Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:11:06Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,multi-port/protocol,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 | port 81 on protocol TCP |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
    - port: 81
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:11:26Z" level=info msg="finished policy #87"
time="2021-03-27T16:11:26Z" level=info msg="starting test case #88"
time="2021-03-27T16:11:29Z" level=info msg="cluster state reset"
time="2021-03-27T16:11:32Z" level=info msg="cluster state verified"
time="2021-03-27T16:11:32Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:11:37Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:11:37Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,multi-port/protocol,named-port,numbered-port,port,rule
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 | port serve-81-tcp on protocol TCP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
    - port: serve-81-tcp
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:11:57Z" level=info msg="finished policy #88"
time="2021-03-27T16:11:57Z" level=info msg="starting test case #89"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:12:00Z" level=info msg="cluster state reset"
time="2021-03-27T16:12:03Z" level=info msg="cluster state verified"
time="2021-03-27T16:12:03Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:12:08Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:12:08Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [x y]                 | port serve-81-udp on protocol UDP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+                                   +
|         |               |              | namespace: all                |                                   |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
    - port: serve-81-udp
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:12:27Z" level=info msg="finished policy #89"
time="2021-03-27T16:12:27Z" level=info msg="starting test case #90"
time="2021-03-27T16:12:30Z" level=info msg="cluster state reset"
time="2021-03-27T16:12:33Z" level=info msg="cluster state verified"
time="2021-03-27T16:12:33Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:12:38Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:12:38Z" level=info msg="running kube probe on try 1"
evaluating test case: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol UDP           |
|         |               |              |   ns In [x y]                 | port serve-81-udp on protocol UDP |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: UDP
    - port: serve-81-udp
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:12:57Z" level=info msg="finished policy #90"
time="2021-03-27T16:12:57Z" level=info msg="starting test case #91"
time="2021-03-27T16:13:00Z" level=info msg="cluster state reset"
time="2021-03-27T16:13:03Z" level=info msg="cluster state verified"
time="2021-03-27T16:13:03Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:13:08Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:13:08Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:13:28Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:13:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:13:33Z" level=info msg="running kube probe on try 1"
evaluating test case: Create/delete policy
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+------+--------+--------------+------+---------------+
| TYPE | TARGET | SOURCE RULES | PEER | PORT/PROTOCOL |
+------+--------+--------------+------+---------------+
|      |        |              |      |               |
+------+--------+--------------+------+---------------+



Results for network policies:
no network policies
0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:13:52Z" level=info msg="finished policy #91"
time="2021-03-27T16:13:52Z" level=info msg="starting test case #92"
time="2021-03-27T16:13:55Z" level=info msg="cluster state reset"
time="2021-03-27T16:13:58Z" level=info msg="cluster state verified"
time="2021-03-27T16:13:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:14:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:14:03Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:14:22Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:14:27Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:14:27Z" level=info msg="running kube probe on try 1"
evaluating test case: Create/update policy
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |           PORT/PROTOCOL           |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols            |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port serve-81-udp on protocol UDP |
|         |               |              |   ns In [x y]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [b c]                |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP           |
|         | Match labels: |              |                               |                                   |
|         |   pod: a      |              |                               |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP           |
|         |               |              |   ns In [y z]                 |                                   |
|         |               |              | pods: Match expressions:      |                                   |
|         |               |              |   pod In [a b]                |                                   |
+         +               +              +-------------------------------+-----------------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP           |
|         |               |              | pods: all                     |                                   |
|         |               |              |                               |                                   |
+---------+---------------+--------------+-------------------------------+-----------------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: serve-81-udp
      protocol: UDP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:14:47Z" level=info msg="finished policy #92"
time="2021-03-27T16:14:47Z" level=info msg="starting test case #93"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:14:50Z" level=info msg="cluster state reset"
time="2021-03-27T16:14:53Z" level=info msg="cluster state verified"
time="2021-03-27T16:14:53Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:14:58Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:14:58Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:15:28Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:15:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:15:33Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:16:02Z" level=info msg="step 3: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:16:07Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:16:07Z" level=info msg="running kube probe on try 1"
evaluating test case: Create/delete namespace
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 11 ignored, 110 correct
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y-2/A | Y-2/B | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |       |       |     |     |     |     |     |     |
| UDP/80 |     |     |     |       |       |     |     |     |     |     |     |
| UDP/81 |     |     |     |       |       |     |     |     |     |     |     |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .     | .     | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X     | X     | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X     | X     | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X     | X     | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| y-2/a  | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| y-2/b  | .   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .     | .     | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-------+-------+-----+-----+-----+-----+-----+-----+

step 3 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
time="2021-03-27T16:16:28Z" level=info msg="finished policy #93"
time="2021-03-27T16:16:28Z" level=info msg="starting test case #94"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:16:31Z" level=info msg="cluster state reset"
time="2021-03-27T16:16:34Z" level=info msg="cluster state verified"
time="2021-03-27T16:16:34Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:16:39Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:16:39Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:16:58Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:17:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:17:04Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:17:25Z" level=info msg="step 3: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:17:30Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:17:31Z" level=info msg="running kube probe on try 1"
evaluating test case: Update namespace so that policy applies, then again so it no longer applies
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   new-ns: qrs                 |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          new-ns: qrs
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   new-ns: qrs                 |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          new-ns: qrs
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 3 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match labels:      | port 80 on protocol TCP |
|         |               |              |   new-ns: qrs                 |                         |
|         |               |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          new-ns: qrs
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:17:52Z" level=info msg="finished policy #94"
time="2021-03-27T16:17:52Z" level=info msg="starting test case #95"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:17:55Z" level=info msg="cluster state reset"
time="2021-03-27T16:17:58Z" level=info msg="cluster state verified"
time="2021-03-27T16:17:58Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:18:03Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:18:03Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:18:27Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:18:32Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:18:32Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:18:57Z" level=info msg="step 3: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:19:02Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:19:02Z" level=info msg="running kube probe on try 1"
evaluating test case: Create/delete pod
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 10 ignored, 90 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | X/D | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/d    | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 3 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [x y]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:19:22Z" level=info msg="finished policy #95"
time="2021-03-27T16:19:22Z" level=info msg="starting test case #96"
time="2021-03-27T16:19:25Z" level=info msg="cluster state reset"
time="2021-03-27T16:19:28Z" level=info msg="cluster state verified"
time="2021-03-27T16:19:28Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:19:33Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:19:33Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:19:54Z" level=info msg="step 2: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:19:59Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:19:59Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:20:19Z" level=info msg="step 3: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:20:24Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:20:24Z" level=info msg="running kube probe on try 1"
evaluating test case: Update pod so that policy applies, then again so it no longer applies
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   new-label: abc              |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+                         +
|         |               |              | namespace: all                |                         |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchLabels:
          new-label: abc
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 2 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   new-label: abc              |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchLabels:
          new-label: abc
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

step 3 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no ips                        | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match labels:           |                         |
|         |               |              |   new-label: abc              |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | ports for all IPs             | port 53 on protocol UDP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: all                | port 53 on protocol UDP |
|         |               |              | pods: all                     |                         |
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchLabels:
          new-label: abc
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:20:44Z" level=info msg="finished policy #96"
time="2021-03-27T16:20:44Z" level=info msg="starting test case #97"
time="2021-03-27T16:20:47Z" level=info msg="cluster state reset"
time="2021-03-27T16:20:50Z" level=info msg="cluster state verified"
time="2021-03-27T16:20:50Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:20:55Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:20:55Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all from source, allow all to dest
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+---------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |    SOURCE RULES     |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+---------------------+-------------------+--------------------------+
| Ingress | namespace: y  | y/allow-all-ingress | all pods, all ips | all ports, all protocols |
|         | Match labels: |                     |                   |                          |
|         |   pod: c      |                     |                   |                          |
+---------+---------------+---------------------+-------------------+--------------------------+
|         |               |                     |                   |                          |
+---------+---------------+---------------------+-------------------+--------------------------+
| Egress  | namespace: x  | x/deny-all-egress   | ports for all IPs | port 53 on protocol UDP  |
|         | Match labels: | x/allow-dns         |                   |                          |
|         |   pod: b      |                     |                   |                          |
+         +               +                     +-------------------+                          +
|         |               |                     | namespace: all    |                          |
|         |               |                     | pods: all         |                          |
|         |               |                     |                   |                          |
+---------+---------------+---------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress
  namespace: "y"
spec:
  ingress:
  - {}
  podSelector:
    matchLabels:
      pod: c
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
time="2021-03-27T16:21:13Z" level=info msg="finished policy #97"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
time="2021-03-27T16:21:13Z" level=info msg="starting test case #98"
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:21:16Z" level=info msg="cluster state reset"
time="2021-03-27T16:21:19Z" level=info msg="cluster state verified"
time="2021-03-27T16:21:19Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:21:24Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:21:24Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:21:45Z" level=info msg="finished policy #98"
time="2021-03-27T16:21:45Z" level=info msg="starting test case #99"
evaluating test case: allow all from source, deny all to dest
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |    SOURCE RULES    |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+--------------------+-------------------+--------------------------+
| Ingress | namespace: y  | y/deny-all-ingress | no pods, no ips   | no ports, no protocols   |
|         | Match labels: |                    |                   |                          |
|         |   pod: c      |                    |                   |                          |
+---------+---------------+--------------------+-------------------+--------------------------+
|         |               |                    |                   |                          |
+---------+---------------+--------------------+-------------------+--------------------------+
| Egress  | namespace: x  | x/allow-all-egress | all pods, all ips | all ports, all protocols |
|         | Match labels: | x/allow-dns        |                   |                          |
|         |   pod: b      |                    |                   |                          |
+---------+---------------+--------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress
  namespace: x
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress
  namespace: "y"
spec:
  podSelector:
    matchLabels:
      pod: c
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | X   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:21:48Z" level=info msg="cluster state reset"
time="2021-03-27T16:21:51Z" level=info msg="cluster state verified"
time="2021-03-27T16:21:51Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:21:56Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:21:56Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all + allow all from same source
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+--------------------+-------------------+--------------------------+
|  TYPE  |    TARGET     |    SOURCE RULES    |       PEER        |      PORT/PROTOCOL       |
+--------+---------------+--------------------+-------------------+--------------------------+
|        |               |                    |                   |                          |
+--------+---------------+--------------------+-------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress  | all pods, all ips | all ports, all protocols |
|        | Match labels: | x/allow-all-egress |                   |                          |
|        |   pod: b      | x/allow-dns        |                   |                          |
+--------+---------------+--------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress
  namespace: x
spec:
  egress:
  - {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:22:15Z" level=info msg="finished policy #99"
time="2021-03-27T16:22:15Z" level=info msg="starting test case #100"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:22:17Z" level=info msg="cluster state reset"
time="2021-03-27T16:22:20Z" level=info msg="cluster state verified"
time="2021-03-27T16:22:20Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:22:25Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:22:25Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all + allow all to same dest
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+---------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |    SOURCE RULES     |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+---------------------+-------------------+--------------------------+
| Ingress | namespace: y  | y/deny-all-ingress  | all pods, all ips | all ports, all protocols |
|         | Match labels: | y/allow-all-ingress |                   |                          |
|         |   pod: c      |                     |                   |                          |
+---------+---------------+---------------------+-------------------+--------------------------+
|         |               |                     |                   |                          |
+---------+---------------+---------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress
  namespace: "y"
spec:
  podSelector:
    matchLabels:
      pod: c
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress
  namespace: "y"
spec:
  ingress:
  - {}
  podSelector:
    matchLabels:
      pod: c
  policyTypes:
  - Ingress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
time="2021-03-27T16:22:45Z" level=info msg="finished policy #100"
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:22:45Z" level=info msg="starting test case #101"
time="2021-03-27T16:22:48Z" level=info msg="cluster state reset"
time="2021-03-27T16:22:51Z" level=info msg="cluster state verified"
time="2021-03-27T16:22:51Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:22:56Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:22:56Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all + allow all by pod from same source
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+---------------------------+-------------------+--------------------------+
|  TYPE  |    TARGET     |       SOURCE RULES        |       PEER        |      PORT/PROTOCOL       |
+--------+---------------+---------------------------+-------------------+--------------------------+
|        |               |                           |                   |                          |
+--------+---------------+---------------------------+-------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress         | ports for all IPs | port 53 on protocol UDP  |
|        | Match labels: | x/allow-all-egress-by-pod |                   |                          |
|        |   pod: b      | x/allow-dns               |                   |                          |
+        +               +                           +-------------------+--------------------------+
|        |               |                           | all pods          | all ports, all protocols |
|        |               |                           |                   |                          |
|        |               |                           |                   |                          |
+--------+---------------+---------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress-by-pod
  namespace: x
spec:
  egress:
  - to:
    - namespaceSelector: {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:23:14Z" level=info msg="finished policy #101"
time="2021-03-27T16:23:14Z" level=info msg="starting test case #102"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:23:17Z" level=info msg="cluster state reset"
time="2021-03-27T16:23:20Z" level=info msg="cluster state verified"
time="2021-03-27T16:23:20Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:23:25Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:23:25Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:23:45Z" level=info msg="running kube probe on try 2"
evaluating test case: deny all + allow all by IP from same source
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+--------------------------+-------------------+--------------------------+
|  TYPE  |    TARGET     |       SOURCE RULES       |       PEER        |      PORT/PROTOCOL       |
+--------+---------------+--------------------------+-------------------+--------------------------+
|        |               |                          |                   |                          |
+--------+---------------+--------------------------+-------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress        | ports for all IPs | port 53 on protocol UDP  |
|        | Match labels: | x/allow-all-egress-by-ip |                   |                          |
|        |   pod: b      | x/allow-dns              |                   |                          |
+        +               +                          +-------------------+--------------------------+
|        |               |                          | 0.0.0.0/0         | all ports, all protocols |
|        |               |                          | except []         |                          |
|        |               |                          |                   |                          |
+        +               +                          +-------------------+--------------------------+
|        |               |                          | namespace: all    | port 53 on protocol UDP  |
|        |               |                          | pods: all         |                          |
|        |               |                          |                   |                          |
+--------+---------------+--------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress-by-ip
  namespace: x
spec:
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Discrepancy found:8 wrong, 9 ignored, 64 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

time="2021-03-27T16:24:04Z" level=info msg="finished policy #102"
time="2021-03-27T16:24:04Z" level=info msg="starting test case #103"

Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/b | X   | .   | X   | X   | X   | X   | X   | X   | X   |
| x/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:24:07Z" level=info msg="cluster state reset"
time="2021-03-27T16:24:10Z" level=info msg="cluster state verified"
time="2021-03-27T16:24:10Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:24:15Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:24:15Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all by IP + allow all by pod from same source
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+---------------------------+-------------------+--------------------------+
|  TYPE  |    TARGET     |       SOURCE RULES        |       PEER        |      PORT/PROTOCOL       |
+--------+---------------+---------------------------+-------------------+--------------------------+
|        |               |                           |                   |                          |
+--------+---------------+---------------------------+-------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress-by-ip   | ports for all IPs | port 53 on protocol UDP  |
|        | Match labels: | x/allow-all-egress-by-pod |                   |                          |
|        |   pod: b      | x/allow-dns               |                   |                          |
+        +               +                           +-------------------+--------------------------+
|        |               |                           | 0.0.0.0/31        | all ports, all protocols |
|        |               |                           | except []         |                          |
|        |               |                           |                   |                          |
+        +               +                           +-------------------+                          +
|        |               |                           | all pods          |                          |
|        |               |                           |                   |                          |
|        |               |                           |                   |                          |
+--------+---------------+---------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress-by-ip
  namespace: x
spec:
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/31
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress-by-pod
  namespace: x
spec:
  egress:
  - to:
    - namespaceSelector: {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:24:34Z" level=info msg="finished policy #103"
time="2021-03-27T16:24:34Z" level=info msg="starting test case #104"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:24:37Z" level=info msg="cluster state reset"
time="2021-03-27T16:24:40Z" level=info msg="cluster state verified"
time="2021-03-27T16:24:40Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:24:45Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:24:45Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:25:05Z" level=info msg="running kube probe on try 2"
evaluating test case: deny all by pod + allow all by IP from same source
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+--------------------------+----------------------------------+--------------------------+
|  TYPE  |    TARGET     |       SOURCE RULES       |               PEER               |      PORT/PROTOCOL       |
+--------+---------------+--------------------------+----------------------------------+--------------------------+
|        |               |                          |                                  |                          |
+--------+---------------+--------------------------+----------------------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress-by-pod | ports for all IPs                | port 53 on protocol UDP  |
|        | Match labels: | x/allow-all-egress-by-ip |                                  |                          |
|        |   pod: b      | x/allow-dns              |                                  |                          |
+        +               +                          +----------------------------------+--------------------------+
|        |               |                          | 0.0.0.0/0                        | all ports, all protocols |
|        |               |                          | except []                        |                          |
|        |               |                          |                                  |                          |
+        +               +                          +----------------------------------+                          +
|        |               |                          | namespace: Match labels:         |                          |
|        |               |                          |   this-will-never-happen: qrs123 |                          |
|        |               |                          | pods: all                        |                          |
+        +               +                          +----------------------------------+--------------------------+
|        |               |                          | namespace: all                   | port 53 on protocol UDP  |
|        |               |                          | pods: all                        |                          |
|        |               |                          |                                  |                          |
+--------+---------------+--------------------------+----------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress-by-pod
  namespace: x
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          this-will-never-happen: qrs123
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-egress-by-ip
  namespace: x
spec:
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Discrepancy found:8 wrong, 9 ignored, 64 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | .   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/b | X   | .   | X   | X   | X   | X   | X   | X   | X   |
| x/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:25:25Z" level=info msg="finished policy #104"
time="2021-03-27T16:25:25Z" level=info msg="starting test case #105"
time="2021-03-27T16:25:28Z" level=info msg="cluster state reset"
time="2021-03-27T16:25:31Z" level=info msg="cluster state verified"
time="2021-03-27T16:25:31Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:25:36Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:25:36Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all + allow all by pod to same source
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+----------------------------+----------+--------------------------+
|  TYPE   |    TARGET     |        SOURCE RULES        |   PEER   |      PORT/PROTOCOL       |
+---------+---------------+----------------------------+----------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress         | no ips   | no ports, no protocols   |
|         | Match labels: | x/allow-all-ingress-by-pod |          |                          |
|         |   pod: b      |                            |          |                          |
+         +               +                            +----------+--------------------------+
|         |               |                            | all pods | all ports, all protocols |
|         |               |                            |          |                          |
|         |               |                            |          |                          |
+---------+---------------+----------------------------+----------+--------------------------+
|         |               |                            |          |                          |
+---------+---------------+----------------------------+----------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress-by-pod
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector: {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:25:54Z" level=info msg="finished policy #105"
time="2021-03-27T16:25:54Z" level=info msg="starting test case #106"
time="2021-03-27T16:25:57Z" level=info msg="cluster state reset"
time="2021-03-27T16:26:00Z" level=info msg="cluster state verified"
time="2021-03-27T16:26:00Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:26:05Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:26:05Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:26:24Z" level=info msg="running kube probe on try 2"
evaluating test case: deny all + allow all by IP to same source
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+---------------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |       SOURCE RULES        |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+---------------------------+-------------------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress        | ports for all IPs | no ports, no protocols   |
|         | Match labels: | x/allow-all-ingress-by-ip |                   |                          |
|         |   pod: b      |                           |                   |                          |
+         +               +                           +-------------------+--------------------------+
|         |               |                           | 0.0.0.0/0         | all ports, all protocols |
|         |               |                           | except []         |                          |
|         |               |                           |                   |                          |
+         +               +                           +-------------------+--------------------------+
|         |               |                           | no pods           | no ports, no protocols   |
|         |               |                           |                   |                          |
|         |               |                           |                   |                          |
+---------+---------------+---------------------------+-------------------+--------------------------+
|         |               |                           |                   |                          |
+---------+---------------+---------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress
  namespace: x
spec:
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress-by-ip
  namespace: x
spec:
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/0
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Discrepancy found:8 wrong, 9 ignored, 64 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| x/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| x/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:26:43Z" level=info msg="finished policy #106"
time="2021-03-27T16:26:43Z" level=info msg="starting test case #107"
time="2021-03-27T16:26:46Z" level=info msg="cluster state reset"
time="2021-03-27T16:26:49Z" level=info msg="cluster state verified"
time="2021-03-27T16:26:49Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:26:54Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:26:54Z" level=info msg="running kube probe on try 1"
evaluating test case: deny all by IP + allow all by pod to same source
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+----------------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |        SOURCE RULES        |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+----------------------------+-------------------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress-by-ip   | ports for all IPs | no ports, no protocols   |
|         | Match labels: | x/allow-all-ingress-by-pod |                   |                          |
|         |   pod: b      |                            |                   |                          |
+         +               +                            +-------------------+--------------------------+
|         |               |                            | 0.0.0.0/31        | all ports, all protocols |
|         |               |                            | except []         |                          |
|         |               |                            |                   |                          |
+         +               +                            +-------------------+                          +
|         |               |                            | all pods          |                          |
|         |               |                            |                   |                          |
|         |               |                            |                   |                          |
+---------+---------------+----------------------------+-------------------+--------------------------+
|         |               |                            |                   |                          |
+---------+---------------+----------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress-by-ip
  namespace: x
spec:
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/31
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress-by-pod
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector: {}
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:27:12Z" level=info msg="finished policy #107"
time="2021-03-27T16:27:12Z" level=info msg="starting test case #108"
time="2021-03-27T16:27:15Z" level=info msg="cluster state reset"
time="2021-03-27T16:27:18Z" level=info msg="cluster state verified"
time="2021-03-27T16:27:18Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:27:23Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:27:23Z" level=info msg="running kube probe on try 1"
time="2021-03-27T16:27:42Z" level=info msg="running kube probe on try 2"
evaluating test case: deny all by pod + allow all by IP to same source
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+---------------------------+----------------------------------+--------------------------+
|  TYPE   |    TARGET     |       SOURCE RULES        |               PEER               |      PORT/PROTOCOL       |
+---------+---------------+---------------------------+----------------------------------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress-by-pod | ports for all IPs                | no ports, no protocols   |
|         | Match labels: | x/allow-all-ingress-by-ip |                                  |                          |
|         |   pod: b      |                           |                                  |                          |
+         +               +                           +----------------------------------+--------------------------+
|         |               |                           | 0.0.0.0/0                        | all ports, all protocols |
|         |               |                           | except []                        |                          |
|         |               |                           |                                  |                          |
+         +               +                           +----------------------------------+                          +
|         |               |                           | namespace: Match labels:         |                          |
|         |               |                           |   this-will-never-happen: qrs123 |                          |
|         |               |                           | pods: all                        |                          |
+---------+---------------+---------------------------+----------------------------------+--------------------------+
|         |               |                           |                                  |                          |
+---------+---------------+---------------------------+----------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress-by-pod
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          this-will-never-happen: qrs123
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-all-ingress-by-ip
  namespace: x
spec:
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/0
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

Discrepancy found:8 wrong, 9 ignored, 64 correct
Expected ingress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| x/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| x/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| y/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/a | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/b | .   | X   | .   | .   | .   | .   | .   | .   | .   |
| z/c | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:28:01Z" level=info msg="finished policy #108"
time="2021-03-27T16:28:01Z" level=info msg="starting test case #109"
time="2021-03-27T16:28:04Z" level=info msg="cluster state reset"
time="2021-03-27T16:28:07Z" level=info msg="cluster state verified"
time="2021-03-27T16:28:07Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:28:12Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:28:12Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: deny all by IP
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+-------------------------+-------------------+--------------------------+
|  TYPE  |    TARGET     |      SOURCE RULES       |       PEER        |      PORT/PROTOCOL       |
+--------+---------------+-------------------------+-------------------+--------------------------+
|        |               |                         |                   |                          |
+--------+---------------+-------------------------+-------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress-by-ip | ports for all IPs | port 53 on protocol UDP  |
|        | Match labels: | x/allow-dns             |                   |                          |
|        |   pod: b      |                         |                   |                          |
+        +               +                         +-------------------+--------------------------+
|        |               |                         | 0.0.0.0/31        | all ports, all protocols |
|        |               |                         | except []         |                          |
|        |               |                         |                   |                          |
+        +               +                         +-------------------+--------------------------+
|        |               |                         | namespace: all    | port 53 on protocol UDP  |
|        |               |                         | pods: all         |                          |
|        |               |                         |                   |                          |
+--------+---------------+-------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress-by-ip
  namespace: x
spec:
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/31
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
time="2021-03-27T16:28:31Z" level=info msg="finished policy #109"
time="2021-03-27T16:28:31Z" level=info msg="starting test case #110"
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:28:34Z" level=info msg="cluster state reset"
time="2021-03-27T16:28:37Z" level=info msg="cluster state verified"
time="2021-03-27T16:28:37Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:28:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:28:42Z" level=info msg="running kube probe on try 1"
evaluating test case: egress: deny all by pod
step 1 on all available ports/protocols:
Policy explanation:
+--------+---------------+-------------------------+----------------------------------+--------------------------+
|  TYPE  |    TARGET     |      SOURCE RULES       |               PEER               |      PORT/PROTOCOL       |
+--------+---------------+-------------------------+----------------------------------+--------------------------+
|        |               |                         |                                  |                          |
+--------+---------------+-------------------------+----------------------------------+--------------------------+
| Egress | namespace: x  | x/deny-all-egress-by-ip | ports for all IPs                | port 53 on protocol UDP  |
|        | Match labels: | x/allow-dns             |                                  |                          |
|        |   pod: b      |                         |                                  |                          |
+        +               +                         +----------------------------------+--------------------------+
|        |               |                         | namespace: Match labels:         | all ports, all protocols |
|        |               |                         |   this-will-never-happen: qrs123 |                          |
|        |               |                         | pods: all                        |                          |
+        +               +                         +----------------------------------+--------------------------+
|        |               |                         | namespace: all                   | port 53 on protocol UDP  |
|        |               |                         | pods: all                        |                          |
|        |               |                         |                                  |                          |
+--------+---------------+-------------------------+----------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-egress-by-ip
  namespace: x
spec:
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          this-will-never-happen: qrs123
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: allow-dns
  namespace: x
spec:
  egress:
  - ports:
    - port: 53
      protocol: UDP
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Egress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|        | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:29:01Z" level=info msg="finished policy #110"
time="2021-03-27T16:29:01Z" level=info msg="starting test case #111"
time="2021-03-27T16:29:03Z" level=info msg="cluster state reset"
time="2021-03-27T16:29:06Z" level=info msg="cluster state verified"
time="2021-03-27T16:29:06Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:29:11Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:29:11Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: deny all by IP
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------------------+-------------------+--------------------------+
|  TYPE   |    TARGET     |       SOURCE RULES       |       PEER        |      PORT/PROTOCOL       |
+---------+---------------+--------------------------+-------------------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress-by-ip | ports for all IPs | no ports, no protocols   |
|         | Match labels: |                          |                   |                          |
|         |   pod: b      |                          |                   |                          |
+         +               +                          +-------------------+--------------------------+
|         |               |                          | 0.0.0.0/31        | all ports, all protocols |
|         |               |                          | except []         |                          |
|         |               |                          |                   |                          |
+         +               +                          +-------------------+--------------------------+
|         |               |                          | no pods           | no ports, no protocols   |
|         |               |                          |                   |                          |
|         |               |                          |                   |                          |
+---------+---------------+--------------------------+-------------------+--------------------------+
|         |               |                          |                   |                          |
+---------+---------------+--------------------------+-------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress-by-ip
  namespace: x
spec:
  ingress:
  - from:
    - ipBlock:
        cidr: 0.0.0.0/31
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:29:31Z" level=info msg="finished policy #111"
time="2021-03-27T16:29:31Z" level=info msg="starting test case #112"
time="2021-03-27T16:29:34Z" level=info msg="cluster state reset"
time="2021-03-27T16:29:37Z" level=info msg="cluster state verified"
time="2021-03-27T16:29:37Z" level=info msg="step 1: waiting 5.000000 seconds for perturbation to take effect"
time="2021-03-27T16:29:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-03-27T16:29:42Z" level=info msg="running kube probe on try 1"
evaluating test case: ingress: deny all by pod
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------------------+----------------------------------+--------------------------+
|  TYPE   |    TARGET     |       SOURCE RULES       |               PEER               |      PORT/PROTOCOL       |
+---------+---------------+--------------------------+----------------------------------+--------------------------+
| Ingress | namespace: x  | x/deny-all-ingress-by-ip | no ips                           | no ports, no protocols   |
|         | Match labels: |                          |                                  |                          |
|         |   pod: b      |                          |                                  |                          |
+         +               +                          +----------------------------------+--------------------------+
|         |               |                          | namespace: Match labels:         | all ports, all protocols |
|         |               |                          |   this-will-never-happen: qrs123 |                          |
|         |               |                          | pods: all                        |                          |
+---------+---------------+--------------------------+----------------------------------+--------------------------+
|         |               |                          |                                  |                          |
+---------+---------------+--------------------------+----------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: deny-all-ingress-by-ip
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          this-will-never-happen: qrs123
  podSelector:
    matchLabels:
      pod: b
  policyTypes:
  - Ingress

0 wrong, 9 ignored, 72 correct
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| TCP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| TCP/81 |     |     |     |     |     |     |     |     |     |
| UDP/80 |     |     |     |     |     |     |     |     |     |
| UDP/81 |     |     |     |     |     |     |     |     |     |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c    | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
|        | .   | X   | .   | .   | .   | .   | .   | .   | .   |
+--------+-----+-----+-----+-----+-----+-----+-----+-----+-----+



time="2021-03-27T16:30:01Z" level=info msg="finished policy #112"
Summary:
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                           TEST                                            | RESULT |   STEP/TRY    | WRONG | RIGHT | IGNORED |       TCP        | SCTP |       UDP        |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 1: set namespace to x                                                                     | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 2: set namespace to y                                                                     | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 3: set namespace to z                                                                     | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 4: set pod selector to                                                                    | passed |               |       |       |         |                  |      |                  |
| ["MatchLabels",null,"MatchExpression",null]                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 5: set pod selector to                                                                    | passed |               |       |       |         |                  |      |                  |
| ["MatchLabels",["pod:                                                                     |        |               |       |       |         |                  |      |                  |
| a"],"MatchExpression",null]                                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 6: set pod selector to                                                                    | passed |               |       |       |         |                  |      |                  |
| ["MatchLabels",null,"MatchExpression",[{"key":"pod","operator":"In","values":["a","b"]}]] |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 7: egress: deny all                                                                       | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 8: egress: allow all                                                                      | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 9: ingress: deny all                                                                      | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 10: ingress: allow all                                                                    | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 11: ingress: empty peers                                                                  | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 12: egress: empty peers                                                                   | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 13: empty pods + nil ns                                                                   | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 14: pods by label + nil ns                                                                | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 15: nil pods + empty ns                                                                   | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 16: empty pods + empty ns                                                                 | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 17: pods by label + empty ns                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 18: nil pods + ns by label                                                                | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 19: empty pods + ns by label                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 20: pods by label + ns by                                                                 | passed |               |       |       |         |                  |      |                  |
| label                                                                                     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 21: simple ipblock                                                                        | failed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     3 |    69 |       9 | 141 / 144 (97%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     3 |    69 |       9 | 141 / 144 (97%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 22: ipblock with except                                                                   | failed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     2 |    70 |       9 | 142 / 144 (98%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     2 |    70 |       9 | 142 / 144 (98%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 23: empty pods + nil ns                                                                   | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 24: pods by label + nil ns                                                                | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 25: nil pods + empty ns                                                                   | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 26: empty pods + empty ns                                                                 | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 27: pods by label + empty ns                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 28: nil pods + ns by label                                                                | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 29: empty pods + ns by label                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 30: pods by label + ns by                                                                 | passed |               |       |       |         |                  |      |                  |
| label                                                                                     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 31: simple ipblock                                                                        | failed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     3 |    69 |       9 | 141 / 144 (97%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     3 |    69 |       9 | 141 / 144 (97%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 32: ipblock with except                                                                   | failed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     2 |    70 |       9 | 142 / 144 (98%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     2 |    70 |       9 | 142 / 144 (98%)  | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 33: egress: empty                                                                         | passed |               |       |       |         |                  |      |                  |
| port/protocol                                                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 34: ingress: empty                                                                        | passed |               |       |       |         |                  |      |                  |
| port/protocol                                                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 35:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,port                                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 36:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port                                                       |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 37:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port                                                       |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 38:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,port,protocol,tcp                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 39:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,tcp                                          |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 40:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,tcp                                          |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 41:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,port,protocol,udp                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 42:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,udp                                          |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 43:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,udp                                          |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 44:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,port,protocol,sctp                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 45:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,sctp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 46:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,egress,numbered-port,port,protocol,sctp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 47:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,tcp                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 48:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,tcp                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 49:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,udp                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 50:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,udp                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 51:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,sctp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 52:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,egress,named-port,port,protocol,sctp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 53: open a named port that                                                                | passed |               |       |       |         |                  |      |                  |
| doesn't match its protocol                                                                |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 54: open a named port that                                                                | passed |               |       |       |         |                  |      |                  |
| isn't served                                                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 55: open a numbered port that                                                             | passed |               |       |       |         |                  |      |                  |
| isn't served                                                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 56:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,port                                                           |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 57:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port                                                      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 58:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port                                                      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 59:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,port,protocol,tcp                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 60:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,tcp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 61:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,tcp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 62:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,port,protocol,udp                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 63:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,udp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 64:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,udp                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 65:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,port,protocol,sctp                                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 66:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,sctp                                        |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 67:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,ingress,numbered-port,port,protocol,sctp                                        |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 68:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,tcp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 69:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,tcp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 70:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,udp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 71:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,udp                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 72:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,sctp                                           |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 73:                                                                                       | failed |               |       |       |         |                  |      |                  |
| direction,ingress,named-port,port,protocol,sctp                                           |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 116 / 144 (80%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 74: open a named port that                                                                | passed |               |       |       |         |                  |      |                  |
| doesn't match its protocol                                                                |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 75: open a named port that                                                                | passed |               |       |       |         |                  |      |                  |
| isn't served                                                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 76: open a numbered port that                                                             | passed |               |       |       |         |                  |      |                  |
| isn't served                                                                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 77:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,multi-port/protocol,numbered-port,port,rule                     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 78:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,multi-port/protocol,named-port,port,rule                        |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 79:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,egress,multi-port/protocol,port,protocol,rule,udp                      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    12 |    60 |       9 | 124 / 144 (86%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    12 |    60 |       9 | 124 / 144 (86%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 80:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,multi-port/protocol,numbered-port,port,rule                              |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 81:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,multi-port/protocol,named-port,numbered-port,port,rule                   |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 82:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 83:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 84:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,multi-port/protocol,numbered-port,port,rule                    |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 85:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,multi-port/protocol,named-port,port,rule                       |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    16 |    56 |       9 | 124 / 144 (86%)  | -    | 112 / 144 (77%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 86:                                                                                       | failed |               |       |       |         |                  |      |                  |
| any-port,direction,ingress,multi-port/protocol,port,protocol,rule,udp                     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |    12 |    60 |       9 | 124 / 144 (86%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |    12 |    60 |       9 | 124 / 144 (86%)  | -    | 120 / 144 (83%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 87:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,multi-port/protocol,numbered-port,port,rule                             |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 88:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,multi-port/protocol,named-port,numbered-port,port,rule                  |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 89:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 90:                                                                                       | passed |               |       |       |         |                  |      |                  |
| direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp     |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 91: Create/delete policy                                                                  | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 92: Create/update policy                                                                  | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 93: Create/delete namespace                                                               | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |   110 |      11 | 220 / 220 (100%) | -    | 220 / 220 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 3, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 94: Update namespace so that                                                              | passed |               |       |       |         |                  |      |                  |
| policy applies, then again so                                                             |        |               |       |       |         |                  |      |                  |
| it no longer applies                                                                      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 3, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 95: Create/delete pod                                                                     | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |    90 |      10 | 180 / 180 (100%) | -    | 180 / 180 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 3, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 96: Update pod so that policy                                                             | passed |               |       |       |         |                  |      |                  |
| applies, then again so it no                                                              |        |               |       |       |         |                  |      |                  |
| longer applies                                                                            |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 2, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 3, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 97: deny all from source,                                                                 | passed |               |       |       |         |                  |      |                  |
| allow all to dest                                                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 98: allow all from source,                                                                | passed |               |       |       |         |                  |      |                  |
| deny all to dest                                                                          |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 99: deny all + allow all from                                                             | passed |               |       |       |         |                  |      |                  |
| same source                                                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 100: deny all + allow all to                                                              | passed |               |       |       |         |                  |      |                  |
| same dest                                                                                 |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 101: deny all + allow all by                                                              | passed |               |       |       |         |                  |      |                  |
| pod from same source                                                                      |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 102: deny all + allow all by                                                              | failed |               |       |       |         |                  |      |                  |
| IP from same source                                                                       |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 103: deny all by IP + allow                                                               | passed |               |       |       |         |                  |      |                  |
| all by pod from same source                                                               |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 104: deny all by pod + allow                                                              | failed |               |       |       |         |                  |      |                  |
| all by IP from same source                                                                |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 105: deny all + allow all by                                                              | passed |               |       |       |         |                  |      |                  |
| pod to same source                                                                        |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 106: deny all + allow all by                                                              | failed |               |       |       |         |                  |      |                  |
| IP to same source                                                                         |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 107: deny all by IP + allow                                                               | passed |               |       |       |         |                  |      |                  |
| all by pod to same source                                                                 |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 108: deny all by pod + allow                                                              | failed |               |       |       |         |                  |      |                  |
| all by IP to same source                                                                  |        |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 2 |     8 |    64 |       9 | 128 / 144 (88%)  | -    | 128 / 144 (88%)  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 109: egress: deny all by IP                                                               | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 110: egress: deny all by pod                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 111: ingress: deny all by IP                                                              | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
| 112: ingress: deny all by pod                                                             | passed |               |       |       |         |                  |      |                  |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+
|                                                                                           |        | Step 1, try 1 |     0 |    72 |       9 | 144 / 144 (100%) | -    | 144 / 144 (100%) |
+-------------------------------------------------------------------------------------------+--------+---------------+-------+-------+---------+------------------+------+------------------+

port counts:
+---------------+--------+--------+----------+
|    FEATURE    | PASSED | FAILED | PASSED % |
+---------------+--------+--------+----------+
| any-port      |      0 |     14 |        0 |
| named-port    |     18 |      6 |       75 |
| numbered-port |     22 |      6 |       78 |
+---------------+--------+--------+----------+

miscellaneous counts:
+--------------+--------+--------+----------+
|   FEATURE    | PASSED | FAILED | PASSED % |
+--------------+--------+--------+----------+
| conflict     |     12 |      4 |       75 |
| pathological |      6 |      0 |      100 |
+--------------+--------+--------+----------+

action counts:
+----------------------+--------+--------+----------+
|       FEATURE        | PASSED | FAILED | PASSED % |
+----------------------+--------+--------+----------+
| create-policy        |      2 |      0 |      100 |
| update-policy        |      1 |      0 |      100 |
| delete-namespace     |      1 |      0 |      100 |
| create-pod           |      1 |      0 |      100 |
| delete-pod           |      1 |      0 |      100 |
| delete-policy        |      1 |      0 |      100 |
| create-namespace     |      1 |      0 |      100 |
| set-namespace-labels |      1 |      0 |      100 |
| set-pod-labels       |      1 |      0 |      100 |
+----------------------+--------+--------+----------+

rule counts:
+---------------------+--------+--------+----------+
|       FEATURE       | PASSED | FAILED | PASSED % |
+---------------------+--------+--------+----------+
| multi-port/protocol |      8 |      6 |       57 |
| deny-all            |      8 |      2 |       80 |
| any-peer            |      2 |      0 |      100 |
| any-port-protocol   |      2 |      0 |      100 |
| allow-all           |      6 |      0 |      100 |
+---------------------+--------+--------+----------+

direction counts:
+---------+--------+--------+----------+
| FEATURE | PASSED | FAILED | PASSED % |
+---------+--------+--------+----------+
| egress  |     36 |     15 |       70 |
| ingress |     36 |     15 |       70 |
+---------+--------+--------+----------+

peer-pods counts:
+---------------------+--------+--------+----------+
|       FEATURE       | PASSED | FAILED | PASSED % |
+---------------------+--------+--------+----------+
| all-pods            |     14 |      0 |      100 |
| policy-namespace    |      4 |      0 |      100 |
| pods-by-label       |      6 |      0 |      100 |
| all-namespaces      |     10 |      0 |      100 |
| namespaces-by-label |      6 |      0 |      100 |
+---------------------+--------+--------+----------+

peer-ipblock counts:
+----------------------+--------+--------+----------+
|       FEATURE        | PASSED | FAILED | PASSED % |
+----------------------+--------+--------+----------+
| ip-block-with-except |      0 |      2 |        0 |
| ip-block-no-except   |      0 |      2 |        0 |
+----------------------+--------+--------+----------+

protocol counts:
+---------+--------+--------+----------+
| FEATURE | PASSED | FAILED | PASSED % |
+---------+--------+--------+----------+
| sctp    |      0 |     10 |        0 |
| udp     |     12 |      4 |       75 |
| tcp     |     14 |      2 |       87 |
+---------+--------+--------+----------+

target counts:
+---------------------+--------+--------+----------+
|       FEATURE       | PASSED | FAILED | PASSED % |
+---------------------+--------+--------+----------+
| target-namespace    |      3 |      0 |      100 |
| target-pod-selector |      3 |      0 |      100 |
+---------------------+--------+--------+----------+

Pass/Fail for probes on protocols:
+---------------+--------+--------+----------+
|   PROTOCOL    | PASSED | FAILED | PASSED % |
+---------------+--------+--------+----------+
| probe on TCP  |  20780 |   1220 |       94 |
| probe on SCTP |      0 |      0 |        0 |
| probe on UDP  |  20528 |   1472 |       93 |
+---------------+--------+--------+----------+
```

# Feature results:

| Tag | Result |
| --- | --- |
| action | 82 / 112 = 73%  |
|  - action: create namespace | 1 / 1 = 100%  |
|  - action: create pod | 2 / 2 = 100%  |
|  - action: create policy | 82 / 112 = 73%  |
|  - action: delete namespace | 1 / 1 = 100%  |
|  - action: delete pod | 1 / 1 = 100%  |
|  - action: delete policy | 1 / 1 = 100%  |
|  - action: set namespace labels | 1 / 1 = 100%  |
|  - action: set pod labels | 1 / 1 = 100%  |
|  - action: update policy | 1 / 1 = 100%  |
| egress | 82 / 112 = 73%  |
|  - 0 peers | 76 / 104 = 73%  |
|  - 0 port/protocols | 8 / 10 = 80%  |
|  - 0 rules | 10 / 13 = 76%  |
|  - 1 peer | 71 / 99 = 71%  |
|  - 1 port/protocol | 75 / 103 = 72%  |
|  - 1 rule | 8 / 10 = 80%  |
|  - 2+ port/protocols | 4 / 7 = 57%  |
|  - 2+ rules | 68 / 94 = 72%  |
|  - IPBlock (no except) | 2 / 5 = 40%  |
|  - IPBlock with except | 0 / 1 = 0%  |
|  - all peers on all ports/protocols | 3 / 3 = 100%  |
|  - named port | 9 / 12 = 75%  |
|  - nil port | 0 / 7 = 0%  |
|  - nil protocol | 5 / 9 = 55%  |
|  - numbered port | 75 / 103 = 72%  |
|  - peer namespace selector empty | 5 / 5 = 100%  |
|  - peer namespace selector match expression | 59 / 83 = 71%  |
|  - peer namespace selector match labels | 4 / 5 = 80%  |
|  - peer namespace selector nil | 2 / 2 = 100%  |
|  - peer pod selector empty | 3 / 3 = 100%  |
|  - peer pod selector match expression | 59 / 83 = 71%  |
|  - peer pod selector match labels | 3 / 3 = 100%  |
|  - peer pod selector nil | 5 / 6 = 83%  |
|  - policy on SCTP | 0 / 5 = 0%  |
|  - policy on TCP | 57 / 73 = 78%  |
|  - policy on UDP | 75 / 103 = 72%  |
| general | 82 / 112 = 73%  |
|  - policy with both ingress and egress | 68 / 94 = 72%  |
|  - policy with egress | 76 / 104 = 73%  |
|  - policy with ingress | 75 / 103 = 72%  |
|  - target: empty pod selector | 1 / 1 = 100%  |
|  - target: pod selector match expression | 1 / 1 = 100%  |
|  - target: pod selector match labels | 80 / 110 = 72%  |
|  - target: specific namespace | 82 / 112 = 73%  |
| ingress | 82 / 112 = 73%  |
|  - 0 peers | 4 / 4 = 100%  |
|  - 0 port/protocols | 8 / 10 = 80%  |
|  - 0 rules | 10 / 13 = 76%  |
|  - 1 peer | 71 / 99 = 71%  |
|  - 1 port/protocol | 63 / 86 = 73%  |
|  - 1 rule | 75 / 103 = 72%  |
|  - 2+ port/protocols | 4 / 7 = 57%  |
|  - IPBlock (no except) | 2 / 5 = 40%  |
|  - IPBlock with except | 0 / 1 = 0%  |
|  - all peers on all ports/protocols | 3 / 3 = 100%  |
|  - named port | 10 / 13 = 76%  |
|  - nil port | 0 / 7 = 0%  |
|  - nil protocol | 5 / 9 = 55%  |
|  - numbered port | 61 / 79 = 77%  |
|  - peer namespace selector empty | 5 / 5 = 100%  |
|  - peer namespace selector match expression | 58 / 82 = 70%  |
|  - peer namespace selector match labels | 5 / 6 = 83%  |
|  - peer namespace selector nil | 2 / 2 = 100%  |
|  - peer pod selector empty | 3 / 3 = 100%  |
|  - peer pod selector match expression | 57 / 81 = 70%  |
|  - peer pod selector match labels | 4 / 4 = 100%  |
|  - peer pod selector nil | 6 / 7 = 85%  |
|  - policy on SCTP | 0 / 5 = 0%  |
|  - policy on TCP | 57 / 73 = 78%  |
|  - policy on UDP | 7 / 9 = 77%  |

Tag results:
| Tag | Result |
| --- | --- |
| action | 6 / 6 = 100%  |
|  - create-namespace | 1 / 1 = 100%  |
|  - create-pod | 1 / 1 = 100%  |
|  - create-policy | 2 / 2 = 100%  |
|  - delete-namespace | 1 / 1 = 100%  |
|  - delete-pod | 1 / 1 = 100%  |
|  - delete-policy | 1 / 1 = 100%  |
|  - set-namespace-labels | 1 / 1 = 100%  |
|  - set-pod-labels | 1 / 1 = 100%  |
|  - update-policy | 1 / 1 = 100%  |
| direction | 70 / 100 = 70%  |
|  - egress | 36 / 51 = 70%  |
|  - ingress | 36 / 51 = 70%  |
| miscellaneous | 18 / 22 = 81%  |
|  - conflict | 12 / 16 = 75%  |
|  - pathological | 6 / 6 = 100%  |
| peer-ipblock | 0 / 4 = 0%  |
|  - ip-block-no-except | 0 / 2 = 0%  |
|  - ip-block-with-except | 0 / 2 = 0%  |
| peer-pods | 20 / 20 = 100%  |
|  - all-namespaces | 10 / 10 = 100%  |
|  - all-pods | 14 / 14 = 100%  |
|  - namespaces-by-label | 6 / 6 = 100%  |
|  - pods-by-label | 6 / 6 = 100%  |
|  - policy-namespace | 4 / 4 = 100%  |
| port | 34 / 56 = 60%  |
|  - any-port | 0 / 14 = 0%  |
|  - named-port | 18 / 24 = 75%  |
|  - numbered-port | 22 / 28 = 78%  |
| protocol | 26 / 42 = 61%  |
|  - sctp | 0 / 10 = 0%  |
|  - tcp | 14 / 16 = 87%  |
|  - udp | 12 / 16 = 75%  |
| rule | 22 / 30 = 73%  |
|  - allow-all | 6 / 6 = 100%  |
|  - any-peer | 2 / 2 = 100%  |
|  - any-port-protocol | 2 / 2 = 100%  |
|  - deny-all | 8 / 10 = 80%  |
|  - multi-port/protocol | 8 / 14 = 57%  |
| target | 6 / 6 = 100%  |
|  - target-namespace | 3 / 3 = 100%  |
|  - target-pod-selector | 3 / 3 = 100%  |
